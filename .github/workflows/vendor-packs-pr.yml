name: Auto Vendor Packs via PR
on:
  release: { types: [published] }
permissions: { contents: write, pull-requests: write }
jobs:
  vendor-pr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }
      - name: Configure git
        run: |
          git config user.name "hardonia-bot"
          git config user.email "hardonia-bot@users.noreply.github.com"
      - name: Create branch
        env: { TAG: ${{ github.event.release.tag_name }} }
        run: git checkout -B "packs/${TAG}"
      - name: Vendor packs
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_OWNER: ${{ github.repository_owner }}
          GITHUB_REPO: ${{ github.event.repository.name }}
          TAG_NAME: ${{ github.event.release.tag_name }}
        run: |
          chmod +x scripts/vendor-packs.sh
          ./scripts/vendor-packs.sh "$TAG_NAME"
      - name: Push branch
        env: { TAG: ${{ github.event.release.tag_name }} }
        run: git push -u origin "packs/${TAG}" || true
      - name: Open PR
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: "packs/${{ github.event.release.tag_name }}"
          title: "Vendor packs for ${{ github.event.release.tag_name }}"
          body: "Automated vendoring of release assets into /packs/*"
          base: main
